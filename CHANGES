4.7.15.0
----
* DB Query for following etools loaders have been extracted;
  
4.7.14
----
* Fix logic error extract_longitude function

4.7.13
----
* Improved FMQuestion and FMOntrack loaders to extract latitude and longitude from 
Location.point when Location.longitude and Location.latitude.

4.7.12
----
Formula for SpotCheckFindings.pending_unsupported_amount has been updated as below;
    = audit_spotcheck.total_amount_of_ineligible_expenditure
      audit_engagement.additional_supporting_documentation_provided
      audit_engagement.justification_provided_and_accepted
      audit_engagement.write_off_required
      audit_engagement.amount_refunded
      
4.7.11
----
CI pipline improvements for version tagging.

4.7.10
----
Further improve Celery task failure error report

4.7.9
----
Make groups parameter name consistent 


----
Hotfix for export access log to handle non-standard  date format

4.7.6
----
* Missing dependencies for FMQuestionLoader, FMOntrack and LocationsiteLoader have been fixed.
* Due to cyclic dependecy between classes, 'depends' Option property was not possible to use. 
  To be able to declare dependency between datamart models (so their loaders), new Options 
  property called 'depends_as_str' has been added. Instantiation of these dependent models now 
  can be postponed to the loader execution time by having string definition of these model classes.
  
  This way, we managed to break the cyclic dependency.
 
  The design still supports 'depends' property but we plan to deprecate this property in the 
  future.

  Please make sure that tupple definition has ',' as in the example below; 

  Example:

  class FMQuestion:
      ... 
      Option:
         depends_as_str = ('etools_datamart.apps.mart.data.model.Location',)
  
* paginator class for prp loader has been updated to the one used by etools loaders.

4.7.5
----
* Stage(country) and record count info along with RUNNING status are made available by extendin 
  the expiry of the cache entry that stores the etl country and count. 

4.7.4
----
* EtoolsUser endpoint filtering by groups 
  Typical usages:
  api/latest/datamart/users/?country_name=Afghanistan&group=FM%20User
  api/latest/datamart/users/?country_name=Afghanistan&group=FM%20User,UNICEF%20User

4.7.3
----
* Country level error reporting for ETL loader's generic loop.

4.7.2
----
* Loader logic has been modified to delete records at country level in the target table when truncate option 
  is enabled.  

4.7.1
----
* ExportAccessLog model and its usage changed. The export access logs include  username now.

4.7.0
----
* add feature that logs timestamp of access to exports

4.6.4
----
* Page size increase for speed up
* Improvement on data.partner by prefetching related T2FTravelactivity 
* Improvement on data.engagement 
* Improvement on data.attachment 
* Improvement on data.agreement (partners) 
* Improvements on data.intervention
* Improvement on data.interventionbudget

4.6.3
----
* As a workaround,increased precision of pdindicator's fields (target_denominator,target_numerator, 
  baseline_denominator, baseline_numerator) to accomodate larger values.  
* Added missing migration for explorer app. 

4.6.2
----
* add missing failure handler for celery tasks to capture the details of the failure

4.6.1 
----
* fix loaders delta logic
* increased PDIndicator.section_name field length 
* fix missing record issue due to the case PDIndicator loader when there is no
  ReportsDisaggregation for a given ReportsAppliedindicator record.

4.6
----
* first phase of reducing sql queries in etl loaders to reduce execution time
* apply ordering specialized paginator

4.5
----
* batched etl loading to reduce memory usage


4.4
----
* added action point filter


4.3
----
* custom user model
* upgrade pacakages


4.2.5
----
* fix partner min requirements

4.2.4
----
* fix partner min requirements


4.2.3
----
* fix partner min requirements


4.2.2
----
* fix partner min requirements


4.2.1
----
* fix partner min requirements


4.2
----
* tweaked unique together on export
* fm questions: added filter


4.1
----
* tweaks realms


4.0
----
* added realms updates
* django 4.2 support


3.59
----
* PRP sync last 180 days


3.58
----
* removed sources services


3.57.1
------
* fixed new FR services


3.57
------
* removed FR sources services
* fixed interventions services


3.56
------
* efficiency data report
* django 4.2


3.55.1
------
* sync deleted params
* humanize export running time
* refresh from db task object


3.55.1
------
* sync deleted params
* humanize export running time
* refresh from db task object


3.55
------
* improved performances
* added newrelic
* introduced black


3.54.2
------
* fixes


3.54.1
------
* added newrelic


3.54
------
* added audit/financial-findings/ endpoint
* added interventions-planned-visits endpoint


3.53.1
------
* fixed MR PV
* fixed travel action point
* fixed intervention-activity


3.53
------
* fixed celery accept content type


3.52
------
* ePD
* fixed xlsx export


3.51.13
-------
* hotfix MR v2


3.51.12
-------
* hotfix MR


3.51.11
-------
* added missing field in serializer


3.51.10
-------
* intervention add outstanding_amt_local


3.51.9
------
* audit fixed start/end date


3.51.8
------
* audit added start/end date


3.51.7
------
* engagements add vendor number


3.51.6
------
* fixed PRP data report


3.51.5
------
* updated FMOptions label length


3.51.4
------
* fixed truncate permission
* fixed intervention budget endpoints


3.51.3
------
* fixed intervention budget endpoints


3.51.2
------
* fixed intervention budget endpoints


3.51.1
------
* fixed intervention budget endpoints


3.51
------
* fixed intervention budget endpoints
* improve performace on FMQuestions


3.50
------
* fixed attachment endpoints
* fixed intervention budget endpoints
* fixed data report

3.49
------
* fixed Trip intervention field
* Data Report: added Indicator Title
* Intervention Budget: fix PartnersInterventionattachment


3.48
------
* updated drf 3.14
* fixed Trip intervention field


3.47
------
* disabled notifications
* updated etag functionality


3.46.1
------
* fixed Safe decimal


3.46
------
* PRP update


3.45
------
* tweak exports


3.44.1
------
* PD export serializers tweaks


3.44
------
* PD export serializers


3.43.7
------
* fr amend light serializer


3.43.6
------
* fr amend light serializer


3.43.5
------
* hact fix


3.43.4
------
* fixed all social auth login urls


3.43.3
------
* fixed social auth login settings


3.43.2
------
* fixed social auth login


3.43.1
------
* rollback django (pg not compatible)


3.43
------
* update to django 4.0
* update to celery 5.2
* fix inspectdb django 3.2/4.0
* tweak partner contact service
* added realm


3.42
------
* admin tweaks
* added partner hact


3.41.1
------
* tweak prp indicator


3.41
------
* updates to eTools 9.12
* FAM: Audit add weakness areas


3.40.2
------
* FAM: Spot checks added missing date


3.40.1
------
* FAM: Spot checks added dates


3.40
------
* PRP data report


3.39
------
* FAM reference number
* fixed User first/last name length


3.38.2
------
* Datareport: fixed report_status
* Intervention: fixed cp_outputs_data


3.38.1
------
* amend fund reservation light serializer


3.38
------
* fix request export for superusers
* amend fund reservation light serializer


3.37
------
* fund reservation light serializer


3.36
------
* fixed office
* amend email notification export


3.35
------
* reset migrations


3.34.1
------
* FM On-track: fixed locations
* FM Question: fixed locations


3.34
------
* PRP attachments improvements
* FM On-track: fixed locations
* FM Question: fixed locations
* fr tweaks


3.33
------
* export tweaks
* update requirements
* fix fund reservation
* amend FM question service


3.32.1
------
* fix permission issues


3.32
------
* export tweaks
* updates to eTools 9.11


3.31.2
------
* data report fix target

3.31.1
------
* engagements: use display status

3.31
------
* travel activity: create record also without location


3.30
------
* engagemements: added sections


3.29.2
------
* fixed hact history service (liquidation & cash transfer)


3.29.1
------
* fixed hact history service (totals by quarter)


3.29
------
* PRP progress report amend


3.28.3
------
* fixed admin template


3.28.2
------
* fmquestion: fixed overall finding


3.28.1
------
* fmontrack: fixed narrative finding


3.28
------
* tweaked fm questions


3.27.3
------
* missing fix


3.27.2
------
* added mr requirements for engagements


3.27.1
------
* fixed partner HACT


3.27
------
* updated to eTools 9.8
* added partner HACT


3.26
------
* added new export notification
* amend progress report service
* amend audit result service


3.25
------
* FmOnTrack: added programme areas
* FAM: added auditor vendor info


3.24
------
* added partner flags


3.23.1
------
* report indicator fix


3.23
----
* fix datareport


3.22
----
* schema update


3.21
----
* prp v2


3.20
----
* prp tweaks


3.19
----
* psea: added cso type


3.18.1
------
* fixed latitude


3.18
-----
* added support to django 3.2
* added location site endpoint
* added psea assessment and answer endpoints


3.17
-----
* tweaks to fmquestions


3.16
-----
* moved to python 3.9


3.15
-----
* added outcomes, outputs, activities apis


3.14
-----
* update fm services


3.13
-----
* add fm option viewset
* simplified hact detail model


3.12
-----
* fixed attachments for interventions
* fixed action points
* tweaked location admin
* added location filter tree_id
* fixed prc attachment


3.11
-----
* fixed locations services (part 2)
* tweaked action points for fm and psea
* amended partner
* removed field maxsize


3.10
-----
* fixed locations services
* fixed fm services
* fixed templates


3.9
-----
* fm endpoint added monitoring activity id and number


3.8
-----
* fund reservation added country name


3.7.1
-----
* fixed headers


3.7
----
* migrated to Django 3.2
* removed obsolete spotcheck model


3.6.1
-----
* fix fm on track


3.6
----
* added location site endpoint
* tweaked fm endpoints
* added higher risk rating for partner endpoint


3.5.1 Hotfix
-----
* prp hotfix


3.5
----
* migrate jsonfield
* fixed fm service
* tweaked attachement etools serializer


3.4
----
* migrated to Django 3.1
* added filterform for export view
* added partner type for fam endpoints


3.3
----
* gateway-type endpoint
* tweaked admin
* migrated do Django 3.0
* removed dbtemplates
* added location gateway endpoint
* fixed xls illegal char issue
* fam added status
* disable export by default


3.2
----
* adjust email settings
* added filters


3.1
----
* fix jwt integration
* added fam exports


3.0
----
* fix ETL
* disable notifications
* update requirements celery 5, drf 3.12
* extract unicef-security


2.14
----
* add geonameid to locations endpoint
* add pd_url to pd indicator endpoint
* set budget values in process_country and not through mapping
* fix InterventionBudget loader queryset

2.13
----
* add new office endpoint
* update etools source to match latest etools
* add ordering to model Meta for pagination where needed

2.12
----
* add disaggregation field to PRP data report

2.11
----
* fixes #18276 - Add `Achievement in reporting period` field to the prp/datareport endpoint


2.10.3
------
* fixes Intervention.frs


2.10.2
------
* fixes DataReportLoader


2.10.1
------
* use poetry instead of pipenv
* BACKWARD INCOMPATIBLE: all `prp` endpoints to the source database moved to `sources/prp`
* BACKWARD INCOMPATIBLE: all `etools` endpoints to the source database moved to `sources/etools`
* Offline requests and File Exports.
* new endpoint audit/spotcheck - ticket #16739
* new endpoint prp/data-report - ticket #16971
* updates schema to eTools 7.4
* updates schema to latest PRP
* fixes RapidPRO endpoints pagination


2.10
----
* Not released in prod


2.9
---
* Not released in prod


2.8
---
* fixes #16623 - wrong visit_url in TPMActivity
* fixes Location / GtewayType Loaders


2.7
-----
* add dedicated check to prevent missing filter declaration
* fixes AuditResult `status` filter
* fixes some missing field filtering
* uses `python:3.6-slim-stretch` as base image


2.6
---
* updates requirements
* add `status` and `vendor_number` to AuditResult
* add `status` filter to AuditResult endpoint

2.5
---
* updates AuditResult
* fixes #15714
* fixes #15746


2.4
---
* new endpoint "datamart/audit/results"
* updates ActionPoint std serializer
* bug fixes
* admin improvements
* filtering improvements


2.3
---
* fixes lat/lng informations
* fixes Intervention.reference_number


2.2
---
* fixes InterventionBudgetLoader
* admin improvements
* improves indexing

2.1
---
* Fixes TripLoader
* add lat/lng info to datamart/interventions/
* add centroid/lat/lng info to datamart/locations/
* add extra filter to datamart/t2f/trips/
* add 'vendor_number' to datamart/audit/engagements
* add 'reference_number' to datamart/audit/engagements
* raise default timeout value


2.0
---
* add PRP source endpoints
* new attachments/attachment endpoint
* improves performance
* bug fixes
* server start as unprivileged user
* upgrade to python 3.7
* dependencies upgrade
* fixes Internet Explorer Content-Disposition issue that prevent file downloading


1.26
----
* fixes Intervention  endpoint


1.25
----
* restored `related_module_class` in ActionPoint
* fixes `partner_id` in Intervention


1.24
----
* improves Admin functionalities
* updates FundsReservation endpoints
* fixes FundsReservation ETL
* updates EtlTask management
* add ability to fully reset data



1.23
----
* Compatible with eTools 7.2
* new FundReservation&Header endpoint
* new Grant endpoint
* new InterventionIndicators endpoint
* new HACT History endpoint
* new HACT aggregate endpoint
* new Engagements endpoint
* new Trips endpoint
* new InterventionBudget endpoint
* updated InterventionByLocation endpoint
* updated Intervention endpoint
* updated TPMActivity endpoint
* updated Partner endpoint
* new v2 intervention serializer
* new PartnerContact endpoint
* new PartnerAgreement endpoint
* new ActionPoint endpoint
* new Workspaces endpoint


1.22
----
* Compatible with eTools 6.10
* New endpoint datamart/actionpoints/
* New endpoint datamart/interventions-locations/
* New endpoint datamart/users/
* New endpoint datamart/users-offices/
* New endpoint datamart/reports/sections/
* New endpoint datamart/partners/contacts/
* New endpoint datamart/partners/agreements/
* Updates datamart/travel-activities
* Updates datamart/travel-activities: add result_* fields
* Updates InterventionSerializerFull: add locations, offices, sections, partner_id and partner_source_id
* fixes Intervention serializers
* fixes formats popup menu
* new LocationMixin
* fixes Partner.hact_values handling
* ActionPoint - new serializer (v2)
* Fixes PDIndicator


1.21
----
* == Not released ==


1.20
----
* fixes FundsReservationLoader
* fixes FAMIndicatorLoader month handling
* fixes HACTLoader
* enable ETLLog reset
* add ability


1.19
----
* add Partner endpoint
* add extra Location fields
* add TravelActivity endpoint


1.18
----
* fixes travel filtering
* disable live stats


1.16
----
* update to eTools 6.7
* improves Loader logic
* add Travel endpoint


1.15
----
* add ability to truncate DataMart tables
* fixes init-setup PeriodicTask creation


1.14
----
* Fix loading Intervention
* migrations reset


1.12
---------
* new endpoint DPIndicator
* preload helpers


1.11
---------
* add impersonation
* fixes schema permission check


1.10
----
* Loader refactoring
* new endpoint 'Funds Reservation'
* add budget informations to interventions


1.9 (dev)
---------
* WARNINGS: migration reset
* Location/GatewayType endpoints
* add action to queue multiple tasks
* updates schema to eTools v6.5.1


1.8
---
* WARNINGS: migration reset
* add ability to create 'per model' custom templates for html/pdf renderers
    new `TEMPLATE_CACHE_URL` enironment variable
* fixes error in some renderers with cached response
* Adopting of RabbitMQ to prevent message loss
* new admin index page
* Excel IQY support (beta)
* Allow endpoints to be consumend bny anonymous users
* Countries can be selected using name, schema_name,country_short_code or business_area_code
* Improved Browseable API
* `page_size` now accept `-1` to disable pagination


1.7
---
* WARNINGS: migration reset
* add YAML format
* new 'Monitor' page to check dataset last update date
* add ability to intercept changed/unchanged datamart records
* Azure storage support
* use versioning in API urls
* add email notifications on dataset changes
* add filter by 'last_modify_date'
* add 'updates/' endpoint to fetch only changes from last ETL
* add XHTML renderer
* add PDF renderer


1.6
---
* add ability to invalidate cache directly from admin endpoint
* add ability to queue task from task log
* invalidate cache on dataset refresh
* add RedisBoard to monitor cache entries
* new HACT endpoint
* add Microsoft style JSON output
* add Microsoft style XML output


1.5
---
* add .xlsx format support
* add ability to invalide all cache at startup (set `INVALIDATE_CACHE` env variable)
* add ability to create default users at startup (set `AUTOCREATE_USERS` env variable)
* enable Azure login without email
* add partner.name to Intervention endpoint


1.4.1
-----
* fixes dependencies


1.4
---
* WARNINGS: migration reset
* updates corepai documentation
* refactor api endpoints
* updates dependencies
* improved schema/country permission checks (multi-tenant/etools)
* improved filtering
* dependencies updates


1.3
---
* Aligned with eTools 6.3.1
* WARNINGS: migration reset
* add ordering support
* updates redoc version
* improves support to handle eTools database changes
* fixes wrog data format in CSV export
* new endpoint FAMIndicator
* new endpoint Tpmvisit
* new endpoint UserStats


1.2
---
* add db logging
* new namespace unicef_security


1.1
---
* Fixes wrong import in middleware


1.0
---
* SystemFilters. Ability to force per user/service filters
* User ACL can grant/demy access to specific serializers
* Internally log any exceptions (django-crashlog)
* Improved endpoint documentation. (Filtering / Lookups )
* removes MultiTenantMiddleware
* everywhere use 'country_name' as schema/tenant selection
* add tracking informations
* allows selection multiple schemas in admin


0.3
---
* TaskLog to monitor ETL task
* Avoid ETL taks overlapping
* Login page
* Add Filtering information to swagger


0.2
---
* add Interventions


0.1
---
* Initial release
